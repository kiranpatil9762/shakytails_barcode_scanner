<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShakyTails - API Test Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f5f5f5;
            display: none;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .token-display {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .token-display strong {
            color: #856404;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pet-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .pet-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .pet-card p {
            margin: 5px 0;
            color: #555;
        }

        .qr-code-display {
            text-align: center;
            margin-top: 20px;
        }

        .qr-code-display img {
            max-width: 300px;
            border: 3px solid #667eea;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêæ ShakyTails</h1>
            <p>Premium QR Pet ID Tag System - Test Dashboard</p>
        </div>

        <!-- Registration Card -->
        <div class="card">
            <h2>1. Register User</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="regName" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="regEmail" placeholder="john@example.com" required>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="regPhone" placeholder="1234567890" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="regPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn">Register</button>
            </form>
            <div id="registerResult" class="result"></div>
        </div>

        <!-- Login Card -->
        <div class="card">
            <h2>2. Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="john@example.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
            <div id="loginResult" class="result"></div>
            <div id="tokenDisplay" class="token-display">
                <strong>üîë Your Token (saved automatically):</strong>
                <p id="tokenValue" style="word-break: break-all; margin-top: 10px;"></p>
            </div>
        </div>

        <!-- Create Pet Card -->
        <div class="card">
            <h2>3. Create Pet Profile</h2>
            <form id="petForm">
                <div class="form-group">
                    <label>QR Code ID (from your physical tag)</label>
                    <input type="text" id="qrCodeId" placeholder="e.g., QR-ABC123-XYZ789">
                    <small style="color: #666; display: block; margin-top: 5px;">üìå Enter the QR code ID from your ShakyTails tag, or leave blank to auto-generate</small>
                </div>
                <div class="form-group">
                    <label>Pet Name</label>
                    <input type="text" id="petName" placeholder="Buddy" required>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="petType" required>
                        <option value="dog">Dog</option>
                        <option value="cat">Cat</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Breed</label>
                    <input type="text" id="petBreed" placeholder="Golden Retriever">
                </div>
                <div class="form-group">
                    <label>Age</label>
                    <input type="number" id="petAge" placeholder="3">
                </div>
                <div class="form-group">
                    <label>Gender</label>
                    <select id="petGender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Medical History</label>
                    <textarea id="petMedical" placeholder="Up to date on vaccinations" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Allergies</label>
                    <input type="text" id="petAllergies" placeholder="None">
                </div>
                <div class="form-group">
                    <label>Reward Note</label>
                    <input type="text" id="petReward" placeholder="$100 reward if found">
                </div>
                <button type="submit" class="btn">Create Pet Profile</button>
            </form>
            <div id="petResult" class="result"></div>
            <div id="qrCodeDisplay" class="qr-code-display"></div>
        </div>

        <!-- My Pets Card -->
        <div class="card">
            <h2>4. My Pets</h2>
            <button onclick="loadMyPets()" class="btn">Load My Pets</button>
            <div id="myPetsResult" class="result"></div>
            <div id="petsList" class="grid"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        let authToken = localStorage.getItem('authToken');

        // Register User
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const resultDiv = document.getElementById('registerResult');
            
            try {
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: document.getElementById('regName').value,
                        email: document.getElementById('regEmail').value,
                        phone: document.getElementById('regPhone').value,
                        password: document.getElementById('regPassword').value
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = '<strong>‚úÖ Success!</strong><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '<strong>‚ùå Error:</strong><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<strong>‚ùå Network Error:</strong> ' + error.message;
                resultDiv.style.display = 'block';
            }
        });

        // Login User
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const resultDiv = document.getElementById('loginResult');
            const tokenDisplay = document.getElementById('tokenDisplay');
            const tokenValue = document.getElementById('tokenValue');
            
            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: document.getElementById('loginEmail').value,
                        password: document.getElementById('loginPassword').value
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = '<strong>‚úÖ Login Successful!</strong><pre>' + JSON.stringify(data.user, null, 2) + '</pre>';
                    tokenDisplay.style.display = 'block';
                    tokenValue.textContent = authToken;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '<strong>‚ùå Error:</strong><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<strong>‚ùå Network Error:</strong> ' + error.message;
                resultDiv.style.display = 'block';
            }
        });

        // Create Pet
        document.getElementById('petForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const resultDiv = document.getElementById('petResult');
            const qrDisplay = document.getElementById('qrCodeDisplay');
            
            if (!authToken) {
                alert('Please login first!');
                return;
            }

            try {
                const petData = {
                    petName: document.getElementById('petName').value,
                    type: document.getElementById('petType').value,
                    breed: document.getElementById('petBreed').value,
                    age: parseInt(document.getElementById('petAge').value) || 0,
                    gender: document.getElementById('petGender').value,
                    medicalHistory: document.getElementById('petMedical').value,
                    allergies: document.getElementById('petAllergies').value,
                    rewardNote: document.getElementById('petReward').value,
                    emergencyContacts: []
                };

                // Include QR code ID if provided
                const qrCodeId = document.getElementById('qrCodeId').value.trim();
                if (qrCodeId) {
                    petData.qrCodeId = qrCodeId;
                }

                const response = await fetch(`${API_BASE}/api/pets/create`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(petData)
                });

                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = '<strong>‚úÖ Pet Profile Created!</strong><pre>' + JSON.stringify(data.pet, null, 2) + '</pre>';
                    
                    if (data.qrCode) {
                        qrDisplay.innerHTML = `
                            <h3>üéâ QR Code Generated!</h3>
                            <img src="${API_BASE}${data.qrCode.qrCodeImage}" alt="QR Code">
                            <p><strong>Public URL:</strong> ${data.qrCode.publicUrl}</p>
                            <p><strong>QR Code ID:</strong> ${data.qrCode.qrCodeId}</p>
                        `;
                    }
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '<strong>‚ùå Error:</strong><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<strong>‚ùå Network Error:</strong> ' + error.message;
                resultDiv.style.display = 'block';
            }
        });

        // Load My Pets
        async function loadMyPets() {
            const resultDiv = document.getElementById('myPetsResult');
            const petsListDiv = document.getElementById('petsList');
            
            if (!authToken) {
                alert('Please login first!');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/pets/mine`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<strong>‚úÖ Found ${data.count} pet(s)</strong>`;
                    resultDiv.style.display = 'block';
                    
                    petsListDiv.innerHTML = '';
                    data.pets.forEach(pet => {
                        const petCard = document.createElement('div');
                        petCard.className = 'pet-card';
                        petCard.innerHTML = `
                            <h3>${pet.petName}</h3>
                            <p><strong>Type:</strong> ${pet.type}</p>
                            <p><strong>Breed:</strong> ${pet.breed || 'N/A'}</p>
                            <p><strong>Age:</strong> ${pet.age || 'N/A'}</p>
                            <p><strong>QR Code ID:</strong> ${pet.qrCodeId}</p>
                            <p><strong>Scans:</strong> ${pet.scanCount}</p>
                            <p><strong>Lost:</strong> ${pet.isLost ? 'üö® Yes' : '‚úÖ No'}</p>
                            ${pet.qrCodeImage ? `<img src="${API_BASE}${pet.qrCodeImage}" alt="QR Code" style="max-width:150px; margin-top:10px; border-radius:8px;">` : ''}
                        `;
                        petsListDiv.appendChild(petCard);
                    });
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '<strong>‚ùå Error:</strong><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    resultDiv.style.display = 'block';
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<strong>‚ùå Network Error:</strong> ' + error.message;
                resultDiv.style.display = 'block';
            }
        }

        // Load token on page load
        if (authToken) {
            document.getElementById('tokenDisplay').style.display = 'block';
            document.getElementById('tokenValue').textContent = authToken;
        }
    </script>
</body>
</html>
